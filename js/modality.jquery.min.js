/* @author: Mark McCann (www.markmccann.me) @license: None, Public Domain */
!function(n,e,t,i){var r="modality",o=n("body")[0],a="click",s="triggers",d="settings",u={bind:!0,"class":"",clickoff:!0,effect:"",enabled:!0,keyboard:!0,open:!1,onClose:"",onOpen:"",inner:"mm-wrap",visible:"mm-show",outer:"modality-modal"},c=function(n){for(var e=0;e<n.length;e++)"function"==typeof n[e]&&n[e]()},f=function(n,e){return""!=n[e]?" "+n[e]:""},l=function(n,e){for(var t=n.length;t--;)if(n[t][0][0]===e[0])return t;return!1},h=function(n){return n===parseInt(n,10)},p=function(n,e){for(var t in n)e[t]="boolean"==typeof e[t]?v(n[t]):n[t];return e},v=function(n){switch(n.toLowerCase()){case"false":case"no":case"0":case"":return!1;default:return!0}},g=function(e,t){var i=this,r=n(e).attr("id"),s=p(e.dataset,n.extend({},u,t)),d=n(e).wrap('<div class="'+s.outer+f(s,"effect")+f(s,"class")+'"><div class="'+s.inner+'"></div></div>').show(),c=d.parents("."+s.outer);return triggers=n('a[href="#'+r+'"], [data-modality="#'+r+'"]'),n.extend(i,{defaults:u,id:r,settings:s,wrapper:c,triggers:[],modal:d}),s.bind&&triggers.each(function(){i.addTrigger(n(this))}),s.clickoff&&(c[a](function(){i.close()}),d[a](function(n){n.stopPropagation()})),s.keyboard&&n(o).keyup(function(n){27==n.keyCode&&i.close()}),-1!=navigator.appVersion.indexOf("MSIE 7.")&&c.prepend('<div class="mm-ghost"></div>'),s.open&&i.open(),i};n.extend(g.prototype,{open:function(n){return this.wrapper.add(o).addClass(this[d].visible),c([this[d].onOpen,n]),this},close:function(n){return this.wrapper.add(o).removeClass(this[d].visible),c([this[d].onClose,n]),this},toggle:function(n){return this.isOpen()?this.close(n):this.open(n)},isOpen:function(){return this.wrapper.hasClass(this[d].visible)},addTrigger:function(n){var e=this,t=e[s],i=l(t,n),r=[n,function(n){n.preventDefault(),e.toggle()}];return h(i)?t[i]=r:t.push(r),e[d].enabled&&r[0].bind(a,r[1]),e},removeTrigger:function(n){var e=this,t=e[s],i=l(t,n);return h(i)&&(t[i][0].unbind(a,t[i][1]),t.splice(i,1)),e},enable:function(){var n=this,e=n[s],t=e.length;if(!n[d].enabled){n[d].enabled=!0;for(var i=0;t>i;i++)e[i][0].bind(a,e[i][1])}return n},disable:function(){var n=this,e=n[s],t=e.length;if(n[d].enabled){n[d].enabled=!1;for(var i=0;t>i;i++)e[i][0].unbind(a,e[i][1])}return n}}),n.extend(g,{instances:{},init:function(e,t){var r={},o=this,a=o.instances,s=0;return e.each(function(){var e=n(this).attr("id");a[e]==i&&(a[e]=r[s]=new o(this,t))}),r[1]===i?r[0]:r}}),n[r]=g,n.fn[r]=function(e){return n[r].init(this,e)},function(){for(var e=n('[data-modality="auto"]'),t=0;t<e.length;t++){var r=n(e[t]).attr("id");r!=i&&n("#"+r).modality()}}()}(jQuery,window,document);