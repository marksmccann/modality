/* @author: Mark McCann (www.markmccann.me) @license: None, Public Domain */
!function(e,n,t,r){var i="modality",o="accessible",a="aria-hidden",s=e("body")[0],c="click",u="tabindex",d="overflow",f="settings",l="triggers",g="wrapper",p={accessible:!0,bind:!0,"class":"",clickoff:!0,effect:"",enabled:!0,keyboard:!0,open:!1,onClose:"",onOpen:"",inner:i+"-inner",outer:i+"-outer"},h=function(e){"function"==typeof e&&e()},v=function(e,n){return""!=e[n]?" "+e[n]:""},b=function(e,n){for(var t=e.length;t--;)if(e[t][0][0]===n[0])return t;return!1},y=function(e,n){for(var t in e)n[t]="boolean"==typeof n[t]?w(e[t]):e[t];return n},m=function(e){return e===parseInt(e,10)},w=function(e){switch(e.toLowerCase()){case"false":case"no":case"0":case"":return!1;default:return!0}},k=function(n,r){var u=this,d=e(n).attr("id"),f=y(n.dataset,e.extend({},p,r)),l=e(n).wrap('<div class="'+f.outer+v(f,"effect")+v(f,"class")+'" '+a+'="true"><div class="'+f.inner+'"></div></div>').show(),g=l.parents("."+f.outer);return triggers=e('a[href="#'+d+'"], [data-modality="#'+d+'"]'),e.extend(u,{id:d,settings:f,wrapper:g,triggers:[],modal:l,triggered:{}}),f.bind&&triggers.each(function(){u.addTrigger(e(this))}),f.clickoff&&g[c](function(e){e.target==g[0]&&u.close()}),f.keyboard&&e(s).keyup(function(e){27==e.keyCode&&u.close()}),f[o]&&e(s).keyup(function(e){u.isOpen()&&!l[0].contains(t.activeElement)&&(e.stopPropagation(),l[0].focus())}),-1!=navigator.appVersion.indexOf("MSIE 7.")&&g.prepend('<div class="'+i+'-ghost"></div>'),f.open&&u.open(),u};e.extend(k.prototype,{open:function(n){var t=this;return e(s).css(d,"hidden"),t[g].attr(a,"false"),t[f][o]&&(t.modal.attr(u,"0"),setTimeout(function(){t.modal[0].focus()},50)),h(t[f].onOpen),h(n),t},close:function(n){var t=this;return e(s).css(d,""),t[g].attr(a,"true"),t[f][o]&&(t.modal.attr(u,"-1"),t.triggered.focus()),h(t[f].onClose),h(n),t},toggle:function(e){return this.isOpen()?this.close(e):this.open(e)},isOpen:function(){return"true"==this[g].attr(a)?!1:!0},addTrigger:function(e){var n=this,t=n[l],r=b(t,e),i=[e,function(t){t.preventDefault(),n.toggle().triggered=e}];return m(r)?t[r]=i:t.push(i),n[f].enabled&&i[0].bind(c,i[1]),n},removeTrigger:function(e){var n=this,t=n[l],r=b(t,e);return m(r)&&(t[r][0].unbind(c,t[r][1]),t.splice(r,1)),n},enable:function(){var e=0,n=this,t=n[l],r=t.length;if(!n[f].enabled)for(n[f].enabled=!0,e;r>e;e++)t[e][0].bind(c,t[e][1]);return n},disable:function(){var e=0,n=this,t=n[l],r=t.length;if(n[f].enabled)for(n[f].enabled=!1,e;r>e;e++)t[e][0].unbind(c,t[e][1]);return n}}),e.extend(k,{instances:{},init:function(n,t){var i,o=0,a={},s=this,c=s.instances;return n.each(function(){i=e(this).attr("id"),i in c||(c[i]=a[o]=new s(this,t))}),a[1]===r?a[0]:a}}),e[i]=k,e.fn[i]=function(n){return e[i].init(this,n)},function(){for(var n=e('[data-modality="auto"]'),t=0;t<n.length;t++){var i=e(n[t]).attr("id");i!=r&&e("#"+i).modality()}}()}(jQuery,window,document);