/* @author: Mark McCann (www.markmccann.me) @license: None, Public Domain */
!function(e,n,t,i){var r="modality",a=e("body")[0],o="click",s="triggers",d="settings",u={bind:!0,"class":"",clickoff:!0,effect:"",enabled:!0,keyboard:!0,open:!1,onClose:"",onOpen:"",inner:"mm-wrap",visible:"mm-show",outer:"modality-modal"},c=function(e){for(var n=0;n<e.length;n++)"function"==typeof e[n]&&e[n]()},f=function(e,n){return""!=e[n]?" "+e[n]:""},l=function(e,n){for(var t=e.length;t--;)if(e[t][0][0]===n[0])return t;return!1},h=function(e){return e===parseInt(e,10)},p=function(e,n){for(var t in e)n[t]="boolean"==typeof n[t]?v(e[t]):e[t];return n},v=function(e){switch(e.toLowerCase()){case"false":case"no":case"0":case"":return!1;default:return!0}},g=function(n,t){var i=this,r=e(n).attr("id"),o=p(n.dataset,e.extend({},u,t)),s=e(n).wrap('<div class="'+o.outer+f(o,"effect")+f(o,"class")+'"><div class="'+o.inner+'"></div></div>').show(),d=s.parents("."+o.outer);return triggers=e('a[href="#'+r+'"], [data-modality="#'+r+'"]'),e.extend(i,{defaults:u,id:r,settings:o,wrapper:d,triggers:[],modal:s}),o.bind&&triggers.each(function(){i.addTrigger(e(this))}),o.clickoff&&d.click(function(e){e.preventDefault(),e.target==i.wrapper[0]&&i.close()}),o.keyboard&&e(a).keyup(function(e){27==e.keyCode&&i.close()}),-1!=navigator.appVersion.indexOf("MSIE 7.")&&d.prepend('<div class="mm-ghost"></div>'),o.open&&i.open(),i};e.extend(g.prototype,{open:function(e){return this.wrapper.add(a).addClass(this[d].visible),c([this[d].onOpen,e]),this},close:function(e){return this.wrapper.add(a).removeClass(this[d].visible),c([this[d].onClose,e]),this},toggle:function(e){return this.isOpen()?this.close(e):this.open(e)},isOpen:function(){return this.wrapper.hasClass(this[d].visible)},addTrigger:function(e){var n=this,t=n[s],i=l(t,e),r=[e,function(e){e.preventDefault(),n.toggle()}];return h(i)?t[i]=r:t.push(r),n[d].enabled&&r[0].bind(o,r[1]),n},removeTrigger:function(e){var n=this,t=n[s],i=l(t,e);return h(i)&&(t[i][0].unbind(o,t[i][1]),t.splice(i,1)),n},enable:function(){var e=this,n=e[s],t=n.length;if(!e[d].enabled){e[d].enabled=!0;for(var i=0;t>i;i++)n[i][0].bind(o,n[i][1])}return e},disable:function(){var e=this,n=e[s],t=n.length;if(e[d].enabled){e[d].enabled=!1;for(var i=0;t>i;i++)n[i][0].unbind(o,n[i][1])}return e}}),e.extend(g,{instances:{},init:function(n,t){var r={},a=this,o=a.instances,s=0;return n.each(function(){var n=e(this).attr("id");o[n]==i&&(o[n]=r[s]=new a(this,t))}),r[1]===i?r[0]:r}}),e[r]=g,e.fn[r]=function(n){return e[r].init(this,n)},function(){for(var n=e('[data-modality="auto"]'),t=0;t<n.length;t++){var r=e(n[t]).attr("id");r!=i&&e("#"+r).modality()}}()}(jQuery,window,document);
