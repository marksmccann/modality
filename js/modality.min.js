/* @author: Mark McCann (www.markmccann.me) @license: None, Public Domain */
(function(){var e="Modality",t=document.getElementsByTagName("body")[0],n={autoBind:true,clickOffToClose:true,closeOnEscape:true,effect:"",innerClass:"mm-wrap",modalClass:"modality-modal",onClose:"",onOpen:"",openClass:"mm-show",openOnLoad:false,userClass:""},r=function(){var e=arguments;for(var t=1;t<e.length;t++)for(var n in e[t])if(e[t].hasOwnProperty(n))e[0][n]=e[t][n];return e[0]},i=function(e,t,n){if(e.attachEvent){e["e"+t+n]=n;e[t+n]=function(){e["e"+t+n](window.event)};e.attachEvent("on"+t,e[t+n])}else{e.addEventListener(t,n,false)}},s=function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},o=function(e,t){if(Object.prototype.toString.call(e)==="[object Array]"){for(var n=0;n<e.length;n++){o(e[n],t)}}else{if(!s(e,t)){e.className+=" "+t}}},u=function(e,t){if(Object.prototype.toString.call(e)==="[object Array]"){for(var n=0;n<e.length;n++){u(e[n],t)}}else{if(s(e,t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)","g");e.className=e.className.replace(r,"")}}},a=function(e,t){var n=document.createElement("div");n.setAttribute("class",t.modalClass+" "+t.effect+" "+t.userClass);n.innerHTML='<div class="'+t.innerClass+'">'+e.outerHTML+"</div>";e.parentNode.replaceChild(n,e);return n},f=function(e,s){var o=this;o.body=t;o.defaults=n;o.id=e.getAttribute("id");o.settings=r({},n,s);o.wrapper=a(e,o.settings);o.triggers=document.querySelectorAll('a[href="#'+o.id+'"], [data-modality="#'+o.id+'"]');o.element=document.getElementById(o.id);if(o.settings.autoBind){for(var u=0;u<o.triggers.length;u++)o.setTrigger(o.triggers[u])}if(o.settings.clickOffToClose){i(o.wrapper,"click",function(e){e.preventDefault();if(e.target==o.wrapper)o.close()},false)}if(o.settings.closeOnEscape){i(o.body,"keyup",function(e){if(e.keyCode==27)o.close()},false)}if(o.element.style.display=="none")o.element.style.display="";if(o.settings.openOnLoad)o.open();return o};r(f.prototype,{open:function(e){o([this.wrapper,this.body],this.settings.openClass);if(typeof this.settings.onOpen=="function")this.settings.onOpen();if(typeof e=="function")e();return this},close:function(e){u([this.wrapper,this.body],this.settings.openClass);if(typeof this.settings.onClose=="function")this.settings.onClose();if(typeof e=="function")e();return this},toggle:function(e){return this.isOpen()?this.close(e):this.open(e)},isOpen:function(){return s(this.wrapper,this.settings.openClass)},setTrigger:function(e){var t=this;i(e,"click",function(e){e.preventDefault();t.toggle()},false);return t}});r(f,{instances:[],extend:r,init:function(e,t){var n={},r=document.querySelectorAll(e);for(var i=0;i<r.length;i++){var s=new this(r[i],t);this.instances[s.id]=n[i]=s}return n[1]===undefined?n[0]:n}});window[e]=f})()
