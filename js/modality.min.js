/* @author: Mark McCann (www.markmccann.me) @license: None, Public Domain */
;(function(){var e="Modality",t=document.querySelector("body"),n={autoBind:true,clickOffToClose:true,closeOnEscape:true,effect:"",innerClass:"mm-wrap",modalClass:"modality-modal",onClose:"",onOpen:"",openClass:"mm-show",openOnLoad:false,userClass:""},r=function(){var e=arguments;for(var t=1;t<e.length;t++)for(var n in e[t])if(e[t].hasOwnProperty(n))e[0][n]=e[t][n];return e[0]},i=function(e,t,n){if(e.attachEvent){e["e"+t+n]=n;e[t+n]=function(){e["e"+t+n](window.event)};e.attachEvent("on"+t,e[t+n])}else{e.addEventListener(t,n,false)}},s=function(e){for(var t=0;t<e.length;t++)if(typeof e[t]=="function")e[t]()},o=function(e){e.preventDefault?e.preventDefault():e.returnValue=false},u=function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},a=function(e,t){for(var n=0;n<e.length;n++)if(!u(e[n],t))e[n].className+=" "+t},f=function(e,t){for(var n=0;n<e.length;n++){if(u(e[n],t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)","g");e[n].className=e[n].className.replace(r,"")}}},l=function(e,t){return e[t]!=""?" "+e[t]:""},c=function(e,t){var n=document.createElement("div");n.setAttribute("class",t.modalClass+l(t,"effect")+l(t,"userClass"));n.innerHTML='<div class="'+t.innerClass+'">'+e.outerHTML+"</div>";e.parentNode.replaceChild(n,e);return n},h=function(e,s){var u=this;u.defaults=n;u.id=e.getAttribute("id");u.settings=r({},n,s);u.wrapper=c(e,u.settings);u.triggers=document.querySelectorAll('a[href="#'+u.id+'"], [data-modality="#'+u.id+'"]');u.modal=document.getElementById(u.id);if(u.settings.autoBind){for(var a=0;a<u.triggers.length;a++)u.setTrigger(u.triggers[a])}if(u.settings.clickOffToClose){i(u.wrapper,"click",function(e){o(e);if(e.target==u.wrapper)u.close()})}if(u.settings.closeOnEscape){i(t,"keyup",function(e){if(e.keyCode==27)u.close()})}if(u.modal.style.display=="none")u.modal.style.display="";if(u.settings.openOnLoad)u.open();return u};r(h.prototype,{open:function(e){a([this.wrapper,t],this.settings.openClass);s([this.settings.onOpen,e]);return this},close:function(e){f([this.wrapper,t],this.settings.openClass);s([this.settings.onClose,e]);return this},toggle:function(e){return this.isOpen()?this.close(e):this.open(e)},isOpen:function(){return u(this.wrapper,this.settings.openClass)},setTrigger:function(e){var t=this;i(e,"click",function(e){o(e);t.toggle()});return t}});r(h,{instances:{},extend:r,init:function(e,t){var n={},r=document.querySelectorAll(e);for(var i=0;i<r.length;i++){var s=new this(r[i],t);this.instances[s.id]=n[i]=s}return n[1]===undefined?n[0]:n}});window[e]=h})();
